<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<script th:src="@{'/js/Chart.min.js'}"></script>
<style type="text/css">/* Chart.js */
@keyframes chartjs-render-animation{from{opacity:.99}to{opacity:1}}.chartjs-render-monitor{animation:chartjs-render-animation 1ms}.chartjs-size-monitor,.chartjs-size-monitor-expand,.chartjs-size-monitor-shrink{position:absolute;direction:ltr;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1}.chartjs-size-monitor-expand>div{position:absolute;width:1000000px;height:1000000px;left:0;top:0}.chartjs-size-monitor-shrink>div{position:absolute;width:200%;height:200%;left:0;top:0}
</style>
<body>
<div class="row">
    <div class="col-8">
        <div class="card">
            <div class="card-body row">
                <div class="col-3">
                    <label for="_select_thang_06_">Thang</label>
                    <select class="form-control" name="" id="_select_thang_06_" onchange="showCharByThang(this.options[this.selectedIndex].value)">
                        <option value="0">Chua chon</option>
                        <option value="1">Thang 1</option>
                        <option value="2">Thang 2</option>
                        <option value="3">Thang 3</option>
                        <option value="4">Thang 4</option>
                        <option value="5">Thang 5</option>
                        <option value="6">Thang 6</option>
                        <option value="7">Thang 7</option>
                        <option value="8">Thang 8</option>
                        <option value="9">Thang 9</option>
                        <option value="10">Thang 10</option>
                        <option value="11">Thang 11</option>
                        <option value="12">Thang 12</option>
                    </select>
                </div>
                <div class="col-3">
                    <label for="_select_thang_06_">Nam</label>
                    <button class="form-control" onclick="showCharByNam(2019)">2019</button>
                </div>
            </div>
            <canvas id="_chart_thong_ke_07_0" width="800" height="450"></canvas>
        </div>

    </div>
</div>


<script>
    showCharByThang(new Date().getMonth() + 1);
    $("#_select_thang_06_").val(new Date().getMonth() + 1).change();
    function showCharByThang(thang) {
        $.get(`${apiResource}thong-ke-thang/${parseInt(thang)}/2019`, res => setThang(thang, res));
    }

    function showCharByNam(nam) {
        $.get(`${apiResource}thong-ke-nam/${nam}`, res => setNam(nam, res));
        $("#_select_thang_06_").val(0);
    }
    function setNam(nam, data) {
        let dataLabel = [];
        let datax = [];
        for (let i = 1; i <= 12 ; i++) {
            dataLabel.push(i);
            datax.push(data[i]);
        }
        veChart(dataLabel, datax, `Thong ke theo nam ${nam}`);
    }

    function setThang(thang, data) {
        let dataLabel = [];
        let datax = [];
        let day = [1,3,5,7,8,10,11].includes(parseInt(thang)) ? 31 : parseInt(thang) === 2 ? 29 : 30;
        for (let i = 1; i <= day ; i++) {
            dataLabel.push(i);
            datax.push(data[i]);
        };
        veChart(dataLabel, datax, `Thong ke theo thang ${thang}`);
    }
    let chart_thong_ke_0_;
    function veChart(dataLabel, data, title) {
        chart_thong_ke_0_ =  new Chart($("#_chart_thong_ke_07_0"), {
            type: 'line',
            data: {
                labels: dataLabel,
                datasets: [{
                    label: '',
                    data: data,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255,99,132,1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            scales: {
                xAxes: [{
                    type: 'time',
                    position: 'bottom',
                    time: {
                        displayFormats: {
                            'day': 'MM/YY'
                        },
                        tooltipFormat: 'DD/MM/YY',
                        unit: 'day',
                    },
                    // leave only one label per month
                    afterTickToLabelConversion: function (data) {
                        var xLabels = data.ticks;
                        var oldLabel = "";
                        xLabels.forEach(function (labels, i) {
                            if(xLabels[i] == oldLabel){
                                xLabels[i] = "";
                            } else {
                                oldLabel = xLabels[i];
                            }
                        });
                    }
                }]
            },
            options: {
                title: {
                    display: true,
                    text: title
                }
            }
        });
    }
</script>
</body>
</html>
